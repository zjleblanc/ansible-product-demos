---
- name: Set up PowerShell for fetching modules
  tags:
    - test
    - test_sql
  ansible.builtin.win_shell: |
    Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force
    Install-Module PowerShellGet -AllowClobber -Force
    Set-PSRepository -Name PSGallery -InstallationPolicy Trusted

- name: "Ensure {{ inventory_hostname }} has SqlServer module"
  tags:
    - test
    - test_sql
  community.windows.win_psmodule:
    name: SqlServer
    state: present
    accept_license: true
